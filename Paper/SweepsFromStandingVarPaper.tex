%\documentclass[authoryear,round]{tufte-book}
\documentclass[a4paper,10pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{fullpage}
\usepackage{color}
\usepackage{natbib}
\usepackage{mathrsfs}
\usepackage{array}
\newcommand{\head}[2]{\multicolumn{1}{>{\centering\arraybackslash}p{#1}}{#2}}
%\usepackage{sidecap}
\usepackage[capbesideposition={top,right},facing=yes,capbesidesep=quad]{floatrow}
\usepackage[hypertexnames=false]{hyperref}
\hypersetup{colorlinks=true, urlcolor=blue, citecolor=black, linkcolor=black}
%\usepackage{lineno}
%\usepackage{lscape}
%\usepackage{multirow}

\newcommand{\var}{\mathop{\mbox{Var}}}
\newcommand{\cov}{\mathop{\mbox{Cov}}}
\newcommand{\gc}[1]{{\it \color{red} (#1)} }
\newcommand{\jb}[1]{{\it\color{blue} (#1)} }
\def\citeapos#1{\citeauthor{#1}'s (\citeyear{#1})}
%\newcommand{\Rho}{\mathrm{P}}

%opening
\title{Theory of Sweeps from Standing Variation}
\author{
Jeremy J. Berg$^{1,2,3}$ and Graham Coop$^{1,2,3}$ \\
$^1$ Graduate Group in Population Biology, University of California, Davis. \\
$^2$ Center for Population Biology, University of California, Davis.\\
$^3$ Department of Evolution and Ecology, University of California, Davis\\
\small To whom correspondence should be addressed: \texttt{jjberg@ucdavis.edu, gmcoop@ucdavis.edu}\\
}

\date{}

\begin{document}

%\linenumbers
\maketitle

\begin{abstract}
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}



%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}
\jb{thinking perhaps we should motivate our whole framework with a fair bit of verbal description before we delve into any math. Ideas here are reletively straightforward, but a fair bit of ``scene setting'' to do first}

The key insight for this paper is that the recombination events that occur during the period when an allele is neutral or balanced prior to a sweep can be treated like mutations, and thus under the assumption of constant population size, we can use the Ewens Sampling Formula to calculate expectations for a variety of quantities of interest in the region surrounding the selected site.

Consider a neutral locus partially linked (with recombination rate $r$) to a second locus where an allele arises, and is initially either neutral, or balanced at a low frequency, but eventually becomes beneficial (due to a change in environment). Our aim is to describe some features of the genealogy at the selected site at at adjacent neutral sites, how these features effect a number of population genetic summary statistics, and to explore the extent to which they can be used to say anything meaningful about sites where sweeps from standing variation may have occurred. 

Let's start with the simple case of a sample of two lineages, and work through how to calculate the expected pairwise diversity relative to neutral levels at a given distance form the selected site. We imagine taking a sample of two lineages at the neutral locus the moment the sweep fixes and tracing their genealogy backwards in time. We separate the history of the locus into two different regimes; the first being the time period during which the sweep is occurring, and the second being the period prior to which the allele became beneficial, during which it was either balanced or neutrally drifting at a constant frequency $f$. We make the simplifying assumptions that only recombination (but no coalescence or mutation) can occur during the course of the sweep, while only recombination and coalescence (but no mutation) can occur during the phase when the beneficial allele is polymorphic but neutral in the population. Therefore all diversity arises due to mutations that occurred (forward in time) before the neutral locus came to be associated with the beneficial allele. We will see from simulation results that this is a reasonable assumption. 

For our purposes it will serve simply to track whether both lineages fail to recombine off of the selected background or not. If either lineage recombines of the selected background, then they coalesce on the standard neutral timescale of $2N$ generations. Otherwise, coalescence during the neutral phase is essentially instantaneous relative to the timescale of mutation, such that we can calculate the expected reduction in pairwise diversity as $1-P_{coal,2}$, where $P_{coal,2}$ is the probability that the two lineages are forced to coalesce before either of them recombines off the background of the beneficial allele. $P_{coal,2}$ can be obtained as $P_{norec,s,2}P_{coalfirst,n,2}$ \jb{I don't know what to call these things in any compact yet readable notation}, where $P_{norec,s,2}$ is the probability that neither lineage recombines off the selected background during the course of the sweep, and $P_{coalfirst,n,2}$ is the probability that the two lineages coalesce during the neutral phase before either of them recombines off the background of the beneficial allele, assuming neither recombined off during the sweep. We'll treat $P_{norec,s,2}$ first and $P_{coalfirst,n,2}$ after that.

If we let $X\left(t\right)$ be the frequency of the selected allele at time $t$ in the past, the probability that a single lineage fails to recombine off in generation $t$ is $e^{-r\left(1-X(t)\right)}$. The probability that a single lineage manages to recombine off the selected background at any point during the course of the sweep is given by $e^{-r \int_f^{1}(1-X\left(t\right))\mathrm{d}X\left(t\right)}$. For now I will simply set $\mathcal{T}_{\left(s,f\right)} = \int_f^{1}(1-X\left(t\right))\mathrm{d}X\left(t\right)$, so that the probability that a lineage manages to recombine off the selected background during the course of the sweep is $e^{-r\mathcal{T}_{\left(s,f\right)}}$. In our sample of two, because we assume that the sweep occurs fast enough that the probability of coalescence during the sweep is essentially zero, the two lineages recombine out of the selected phase independently, and thus
$$P_{norec,s,2} = e^{-2r\mathcal{T}_{\left(s,f\right)}}.$$

Now let's consider the second phase, in which the (soon to be) beneficial allele is either balanced or neutral. We make the simplifying assumption that if the frequency of the allele was $f$ when the sweep began, then it is held constant at $f$ for the time period that is relevant to the processes we are interested in. Because the two alleles exist within a small subpopulation with size $2Nf$, they coalesce at rate $\frac{1}{2Nf}$. Each lineage at the neutral locus recombines off the background of the (future) selected allele at a rate $r(1-f)$. Therefore, the probability that the two lineages coalesce before either of them manages to recombine off the background is given by
$$P_{coalfirst,n,2} = \frac{\frac{1}{2Nf}}{\frac{1}{2Nf} + r(1-f)} = \frac{1}{1 + 4Nrf(1-f)}.$$

Taking these together we find that the expected pairwise diversity at distance $r$ away from a sweep from standing variation that begins from frequency $f$ is approximately equal to
$$\pi_{r,s,f} = \pi_0\left(1 - \frac{e^{-2r\mathcal{T}_{\left(s,f\right)}}}{1 + 4Nrf\left(1-f\right)}\right).$$

Examining the formula for $P_{coalfirst,n,2}$, we notice that it is very similar to the formula for the probability that two lineages chosen randomly from a population are of the same allelic type under the Ewens Sampling Formula, which is given by $\frac{1}{1+4N\mu}$. Specifically, we've just replaced the mutation parameter $\mu$ in the standard Ewens Sample Formula with the compound parameter $rf\left(1-f\right)$, which can be thought of as the per generation probability that a randomly chosen lineage recombines off of the background of the beneficial allele onto the other background (there is a probability $f$ that the randomly chosen lineage is currently on the beneficial background, and given that it is, a probability $r\left(1-f\right)$ that it recombines onto the other background). For ease of bookkeeping, we will let $R_f = 4Nrf\left(1-f\right)$.

The observation regarding the the Ewens Sampling Formula above is in fact general, in the sense that if $n$ lineages sampled in the present day fail to recombine off of the selected background during the course of the sweep, then the  probability that these $n$ lineages coalesce into a set of $k$ families and that the number of coalescent families with $1,2,\dots,n$ lineages is given by the partition $\{a_1,a_2,\dots,a_n\}$ is 
$$P\left(k,a_1,a_2,\dots,a_n\right) = \frac{n!R_f^k}{{R_f}_{\left(n\right)}}\prod_{j=1}^n\frac{1}{j^{a_j}a_j!}$$
where ${R_f}_{\left(n\right)} = \prod_{i=0}^{n-1}\left(R_f+i\right)$.

\section{Discussion}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Acknowledgements}

\section{Methods}


\bibliographystyle{genetics}
\bibliography{library,morelibrary}

\section{Supplementary materials}

\setcounter{table}{0}
\renewcommand{\thetable}{S\arabic{table}}
\setcounter{figure}{0}
\renewcommand{\thefigure}{S\arabic{figure}}

\end{document}
